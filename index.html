<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Example</title>
    <style>
        table, th, td {
            border: 1px solid black;
        }
    </style>
    <script>
        const socket = new WebSocket('ws://localhost:1234');
        socket.onmessage = event => {
            try {
                const parsedData = JSON.parse(event.data);
                for (let i = 0; i < parsedData.length; i++) {
                    addRow(parsedData[i].name, parsedData[i].type, parsedData[i].url);
                }
            } catch (error) {
                console.error('Error parsing JSON:', error);
            }
        };
        function addRow(name, type, url){
            var table = document.getElementById("file-table");
            var row = table.insertRow(-1);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            cell1.innerHTML = name;
            cell2.innerHTML = type;
            // cell3.innerHTML = url;
            // cell3.innerHTML = `<a href="${url}" onclick="downloadFile(url, name)">Download</a>`;
            // cell3.innerHTML = `<a onclick="downloadFile('${url}', '${name}')">Download</a>`;
            cell3.innerHTML = `<button type="submit" name="filename" value="${name}">Download</button>`
        }

        function downloadFile(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</head>
<body>

<form action="/download-file">

<table id="file-table">
    <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Action</th>
    </tr>

</table>

</form>

<div id="message"></div>

</body>
</html>